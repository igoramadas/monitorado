<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Monitorado</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">Monitorado</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> Monitorado</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#monitorado" id="monitorado" style="color: inherit; text-decoration: none;">
					<h1>Monitorado</h1>
				</a>
				<p><a href="https://npmjs.com/package/monitorado"><img src="https://img.shields.io/npm/v/monitorado.svg" alt="Version"></a>
					<a href="https://travis-ci.org/igoramadas/monitorado"><img src="https://img.shields.io/travis/igoramadas/monitorado.svg" alt="Build Status"></a>
				<a href="https://coveralls.io/github/igoramadas/monitorado?branch=master"><img src="https://img.shields.io/coveralls/igoramadas/monitorado.svg" alt="Coverage Status"></a></p>
				<p>A simple but effective library to track app metrics.</p>
				<a href="#basic-usage" id="basic-usage" style="color: inherit; text-decoration: none;">
					<h2>Basic usage</h2>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">const</span> monitorado = <span class="hljs-built_in">require</span>(<span class="hljs-string">"monitorado"</span>)

<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// Start a metric to calculate how long the DB cleanup takes...</span>
    <span class="hljs-keyword">let</span> mt = monitorado.start(<span class="hljs-string">"db-cleanup"</span>)

    <span class="hljs-comment">// Cleanup database...</span>
    <span class="hljs-keyword">await</span> myApp.cleanupDatabase()

    <span class="hljs-comment">// End db-cleanup metric.</span>
    mt.end()

} <span class="hljs-keyword">catch</span> (ex) {
    <span class="hljs-comment">// End metric with error.</span>
    mt.end(ex)
}

<span class="hljs-comment">// Get metrics output.</span>
<span class="hljs-keyword">let</span> output = monitorado.output()

<span class="hljs-comment">// Last 1 minute metrics for db-cleanup...</span>
<span class="hljs-built_in">console</span>.dir(output[<span class="hljs-string">"db-cleanup"</span>].last_1min)</code></pre>
				<a href="#more-features" id="more-features" style="color: inherit; text-decoration: none;">
					<h3>More features</h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {

    <span class="hljs-comment">// Auto expire counter after 5 seconds.</span>
    <span class="hljs-keyword">let</span> expiringMt = monitorado.start(<span class="hljs-string">"timeout-method"</span>, {<span class="hljs-attr">expiresIn</span>: <span class="hljs-number">5000</span>})
    <span class="hljs-keyword">await</span> myApp.externalCall()

    <span class="hljs-comment">// If externalCall takes more than 5 sec, counter will auto-expire</span>
    <span class="hljs-comment">// so calling .end() won't do anything.</span>
    expiringMt.end()
}

<span class="hljs-comment">// Create metric with a tag.</span>
<span class="hljs-keyword">let</span> anotherMt = monitorado.start(<span class="hljs-string">"user-method"</span>, {<span class="hljs-attr">tag</span>: <span class="hljs-string">"Users"</span>})
<span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> myApp.getUserStats()

<span class="hljs-comment">// Add extra data to metric, for instance a user count.</span>
anotherMt.setData(<span class="hljs-string">"users"</span>, result.users)
anotherMt.end()

<span class="hljs-comment">// Output metrics for timeout-method only, for the last 1, 2, and 5 minutes.</span>
<span class="hljs-keyword">const</span> outputOptions = {<span class="hljs-attr">intervals</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">5</span>], <span class="hljs-attr">keys</span>:  [<span class="hljs-string">"timeout-method"</span>]}
<span class="hljs-keyword">let</span> timeoutOutput = monitorado.output(outputOptions)</code></pre>
				<a href="#built-in-http-server" id="built-in-http-server" style="color: inherit; text-decoration: none;">
					<h3>Built-in HTTP server</h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// Set a custom port and base path.</span>
    monitorado.settings.httpServer.port = <span class="hljs-number">8080</span>
    monitorado.settings.httpServer.path = <span class="hljs-string">"/metrics"</span>

    <span class="hljs-comment">// Or you can also load and manipulate settings directly via SetMeUp...</span>
    <span class="hljs-keyword">const</span> setmeup = <span class="hljs-built_in">require</span>(<span class="hljs-string">"setmeup"</span>)
    setmeup.load(<span class="hljs-string">"settings.monitorado.json"</span>)

    <span class="hljs-comment">// Start the built-in HTTP server</span>
    monitorado.httpServer.start()
    <span class="hljs-comment">// Calling http://your-host:8080/metrics will output the metrics.</span>

    <span class="hljs-comment">// You can also protect the endpoint with a token.</span>
    monitorado.settings.httpServer.token = <span class="hljs-string">"my-custom-token"</span>
    <span class="hljs-comment">// Now you need to pass an Authorization: Bearer my-customer-token header.</span>
}</code></pre>
				<a href="#persisting-metrics" id="persisting-metrics" style="color: inherit; text-decoration: none;">
					<h3>Persisting metrics</h3>
				</a>
				<pre><code class="language-javascript"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// Save current finished metrics to the monitorado.json file.</span>
    monitorado.metrics.saveTo()

    <span class="hljs-comment">// You can also specify a different file path.</span>
    monitorado.metrics.saveTo(<span class="hljs-string">"/usr/data/monitorado.json"</span>)

    <span class="hljs-comment">// Or simply get the exported JSON as as object.</span>
    <span class="hljs-keyword">let</span> data = monitorado.metrics.toJSON()
    <span class="hljs-comment">// Send data above to an external storage, S3, etc...</span>

    <span class="hljs-comment">// Now load metrics from an exported file.</span>
    monitorado.metrics.loadFrom(<span class="hljs-string">"/usr/data/monitorado.json"</span>)

    <span class="hljs-comment">// Or load from an exported object directly. For example, download JSON data from S3.</span>
    <span class="hljs-keyword">let</span> s3data = myS3.downloadFile(<span class="hljs-string">"monitorado.json"</span>)
    monitorado.metrics.loadFrom(s3data)

    <span class="hljs-comment">// You can also avoid loading metrics that already exists in memory by using avoidDuplicates = true.</span>
    monitorado.metrics.loadFrom(s3data, <span class="hljs-literal">true</span>)
}</code></pre>
				<a href="#default-settings" id="default-settings" style="color: inherit; text-decoration: none;">
					<h2>Default settings</h2>
				</a>
				<p>In a nutshell, the <a href="https://raw.githubusercontent.com/igoramadas/monitorado/master/settings.default.json">default settings</a>
					contains all the defaults used by Monitorado. You can override settings
					by creating a <code>settings.json</code> on the root of your app, or programatically
				by changing values directly on the <code>monitorado.settings</code> object.</p>
				<p>Monitorado uses <a href="https://github.com/igoramadas/setmeup">SetMeUp</a> to manage
					its settings, so you might want to take a look there for some insights and
				how to define your custom settings.</p>
				<a href="#sample-output" id="sample-output" style="color: inherit; text-decoration: none;">
					<h2>Sample output</h2>
				</a>
				<p>Below you&#39;ll find a sample output generated by Monitorado for a sample app,
				with comments added for reference:</p>
				<pre><code class="language-json">{
    // Some system metrics taken from jaul.system.getInfo()
    &quot;system&quot;: {
        &quot;loadAvg&quot;: 1,
        &quot;memoryUsage&quot;: 61
    },
    // Metrics for &quot;ad.fetch&quot;
    &quot;ad.fetch&quot;: {
        &quot;total_calls&quot;: 930, // total number of calls currently recorded
        // Following counters are for the last 1 minute...
        &quot;last_1min&quot;: {
            &quot;calls&quot;: 17, // 17 calls
            &quot;errors&quot;: 0, // 0 calls with errors
            &quot;expired&quot;: 1, // 1 expired calls
            &quot;min&quot;: 305, // minimum elapsed time 305ms
            &quot;max&quot;: 399, // maximum elapsed time 399ms
            &quot;avg&quot;: 373, // average elapsed time of 373ms
            &quot;p99&quot;: 399, // 99 percentile 399ms
            &quot;p90&quot;: 385 // 90 percentile 385ms
        },
        // The following counters are for the last 20 minutes...
        &quot;last_20min&quot;: {
            &quot;calls&quot;: 840,
            &quot;errors&quot;: 2,
            &quot;expired&quot;: 1,
            &quot;min&quot;: 305,
            &quot;max&quot;: 970,
            &quot;avg&quot;: 391,
            &quot;p99&quot;: 399,
            &quot;p90&quot;: 390,
            // Extra data appended to counters on last 20 minutes,
            // for example mt.setData(&quot;users&quot;, 35).
            &quot;data&quot;: {
                &quot;users&quot;: {
                    &quot;min&quot;: 35,
                    &quot;max&quot;: 35,
                    &quot;total&quot;: 35
                }
            }
        }
    },
    // Same as above, for for &quot;google.fetch&quot;...
    &quot;google.fetch&quot;: {
        &quot;total_calls&quot;: 1410,
        &quot;last_1min&quot;: {
            &quot;calls&quot;: 19,
            &quot;errors&quot;: 0,
            &quot;expired&quot;: 0,
            &quot;min&quot;: 2100,
            &quot;max&quot;: 3755,
            &quot;avg&quot;: 2900,
            &quot;p99&quot;: 3755,
            &quot;p90&quot;: 2920
        },
        &quot;last_20min&quot;: {
            &quot;calls&quot;: 1403,
            &quot;errors&quot;: 0,
            &quot;expired&quot;: 0,
            &quot;min&quot;: 2008,
            &quot;max&quot;: 3940,
            &quot;avg&quot;: 2974,
            &quot;p99&quot;: 3001,
            &quot;p90&quot;: 2976
        }
    }
}</code></pre>
				<p>On the sample above, the first <code>system</code> key is shown because the <code>systemMetrics</code>
					setting has key = &quot;system and fields &quot;loadAvg&quot; and &quot;memoryUsage&quot;. For the list
					of available fields, please check the
					<a href="https://jaul.devv.com/interfaces/_system_.systemmetrics.html">SystemMetrics interface</a>
				from JAUL.</p>
				<p>Each of the next keys &quot;ad.fetch&quot; and &quot;google.fetch&quot; represent a specific metric. The settings
				<code>intervals</code> for the above sample is set to &quot;[1, 20]&quot;. The setting <code>percentiles</code> is &quot;[99, 90]&quot;.</p>
				<p>Please note that the <code>total_calls</code> for a particular metric can be higher than the <code>calls</code>
					for the highest interval shown on the output. The <code>total_calls</code> simply tells us how
					many counters are currently stored for that metric, and is directly dependant on the
				<code>expireAfter</code> setting.</p>
				<a href="#api-documentation" id="api-documentation" style="color: inherit; text-decoration: none;">
					<h2>API documentation</h2>
				</a>
				<p>You can browse the full API documentation at <a href="https://monitorado.devv.com">https://monitorado.devv.com</a>.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_counter_.html">"counter"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_httpserver_.html">"httpserver"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_index_.html">"index"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_metrics_.html">"metrics"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_output_.html">"output"</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_percentile_.html">"percentile"</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-9331973-4', '');
        ga('send', 'pageview');
    </script>
</body>
</html>